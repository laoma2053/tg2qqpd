# ==================================================
# tg2qqpd ç»Ÿä¸€é…ç½®æ–‡ä»¶
# ==================================================
#
# ä¿®æ”¹åé‡å¯å¯¹åº”å®¹å™¨å³å¯ç”Ÿæ•ˆï¼š
#   docker compose restart backend worker
#
# æ•æ„Ÿå‡­è¯ï¼ˆAPI ID / Secret / Tokenï¼‰ä»ç•™åœ¨ .env ä¸­ï¼Œ
# ç”± Docker Compose env_file æ³¨å…¥ï¼Œæœ¬æ–‡ä»¶é€šè¿‡ ${ENV_VAR} è¯­æ³•å¼•ç”¨ã€‚
# ==================================================

# --------------------------------------------------
# Telegram é…ç½®
# --------------------------------------------------
telegram:
  # API å‡­è¯ï¼ˆä» .env æ³¨å…¥ï¼Œä¸è¦ç›´æ¥å†™æ˜æ–‡ï¼‰
  api_id: ${TG_API_ID}
  api_hash: ${TG_API_HASH}

  # Session åç§°ï¼ˆç™»å½•æ€æ–‡ä»¶åï¼Œå»ºè®®å›ºå®šä¸è¦é¢‘ç¹æ”¹ï¼‰
  session: userbot
  session_dir: /app/sessions

  # ç›‘å¬æ¥æºï¼ˆæ”¯æŒ @username / t.me é“¾æ¥ / æ•°å€¼ IDï¼‰
  # è´¦å·å¿…é¡»å·²åŠ å…¥/å¯è®¿é—®
  sources:
    - "@Q_dianshiju"
    - "@Q_dongman"
    - "@Q_dianying"
    - "@Q_jilupian"
    - "@Aliyun_4K_Movies"

# --------------------------------------------------
# QQ é¢‘é“ Bot é…ç½®
# --------------------------------------------------
qq:
  # API å‡­è¯ï¼ˆä» .env æ³¨å…¥ï¼‰
  app_id: ${QQ_APP_ID}
  app_secret: ${QQ_APP_SECRET}
  bot_token: ${QQ_BOT_TOKEN}

  # æ‰‹åŠ¨æŒ‡å®š access_tokenï¼ˆç•™ç©ºåˆ™è‡ªåŠ¨åˆ·æ–°ï¼Œæ¨èç•™ç©ºï¼‰
  access_token: ""

  # OpenAPI åœ°å€ï¼ˆä¸€èˆ¬ä¸éœ€è¦æ”¹ï¼‰
  api_base: "https://api.sgroup.qq.com"

  # access_token æå‰åˆ·æ–°çª—å£ï¼ˆç§’ï¼‰
  access_token_refresh_skew: 60

  # WS intentsï¼ˆä¿æ´»é»˜è®¤åªè®¢é˜…æœ€å° GUILDS: 1ï¼‰
  ws_intents: 1
  ws_log_interval_seconds: 60
  ws_ready_timeout_seconds: 20

  # ç›®æ ‡é¢‘é“ï¼ˆæœåŠ¡å™¨ï¼‰guild_id
  target_guild_id: "3628508121088643592"

  # ç›®æ ‡å­é¢‘é“ channel_idï¼ˆç•™ç©ºåˆ™æ ¹æ® guild_id è‡ªåŠ¨é€‰æ‹©ç¬¬ä¸€ä¸ªå¯å‘è¨€é¢‘é“ï¼‰
  target_channel_id: ""

  # å‘é€æœ€å°é—´éš”ï¼ˆç§’ï¼‰ï¼Œé˜²é£æ§
  send_interval: 30

# --------------------------------------------------
# åå°ç®¡ç† & é‰´æƒ
# --------------------------------------------------
admin:
  # JWT ç­¾åå¯†é’¥ï¼ˆä» .env æ³¨å…¥ï¼‰
  jwt_secret: ${JWT_SECRET}
  # åå°ç®¡ç†å¯†ç 
  admin_pass: ${ADMIN_PASS}
  # JWT è¿‡æœŸæ—¶é—´ï¼ˆç§’ï¼‰ï¼Œé»˜è®¤ 7 å¤©
  jwt_expire_seconds: 604800

# --------------------------------------------------
# è½¬å‘è¡Œä¸º
# --------------------------------------------------
forward:
  # æ€»å¼€å…³
  enabled: true
  # ç°åº¦æ¯”ä¾‹ï¼š0~1ï¼ˆ1=å…¨é‡è½¬å‘ï¼‰
  gray_ratio: 1
  # å‘é€æ¨¡æ¿ï¼ˆå¯é€‰ï¼Œä¸éœ€è¦å°±ç•™ç©ºï¼‰
  template_prefix: ""
  template_suffix: ""

# --------------------------------------------------
# è¿‡æ»¤è§„åˆ™ï¼ˆé»‘åå•ä¼˜å…ˆ + å¯é€‰ç™½åå•ï¼‰
# --------------------------------------------------
rules:
  filter:
    # é»‘åå•å…³é”®è¯ï¼ˆå‘½ä¸­å³ä¸¢å¼ƒï¼Œæœ€é«˜ä¼˜å…ˆçº§ï¼‰
    block_keywords:
      - "æŠ½å¥–"
      - "æ³¨å†Œ"
      - "å¨±ä¹"
      - "æ–°ä¼šå‘˜"
      - "æœç´¢"
    # é»‘åå•æ­£åˆ™
    block_regex:
      - "(?i)telegram\\.me/"
      - "(?i)t\\.me/"
    # ç™½åå•å…³é”®è¯
    allow_keywords:
      - "4K"
    # ç™½åå•æ­£åˆ™
    allow_regex: []
    # æ˜¯å¦å¿…é¡»å‘½ä¸­ç™½åå•æ‰è½¬å‘ï¼ˆtrue=åªè½¬å‘å«ç™½åå•å…³é”®è¯çš„ï¼›false=é»‘åå•æ²¡å‘½ä¸­å°±æ”¾è¡Œï¼‰
    require_allows: false

  # ------------------------------------------------
  # æ–‡æ¡ˆæ¸…æ´—è§„åˆ™ï¼ˆä»ä¸Šåˆ°ä¸‹ä¾æ¬¡æ‰§è¡Œï¼‰
  # ------------------------------------------------
  # æ”¯æŒç±»å‹ï¼š
  #   regex_replace â€” æ­£åˆ™æ›¿æ¢ï¼ˆpattern â†’ replï¼‰
  #   append        â€” è¿½åŠ å›ºå®šæ–‡æœ¬åˆ°æœ«å°¾
  #
  # æ­£åˆ™è¯´æ˜ï¼š
  #   ä½¿ç”¨ Python re è¯­æ³•
  #   flags å¯é€‰ï¼šs(DOTALL) m(MULTILINE) i(IGNORECASE)ï¼Œé»˜è®¤ "ms"
  #   repl ä¸ºç©ºå­—ç¬¦ä¸² "" è¡¨ç¤ºåˆ é™¤åŒ¹é…å†…å®¹
  #
  # æ‰§è¡Œå®Œæ‰€æœ‰è§„åˆ™åï¼Œå†…ç½®åš"å¤šç©ºè¡Œæ”¶æ•›"å’Œ"é¦–å°¾å»ç©ºç™½"ã€‚
  # ------------------------------------------------
  transforms:

    # (1) å°†é¦–è¡Œå‰ç¼€"åç§°ï¼š"æ›¿æ¢ä¸º"ğŸ¬å·²æ›´æ–°ï¼š"
    - type: regex_replace
      pattern: "^åç§°[:ï¼š]\\s*"
      repl: "ğŸ¬å·²æ›´æ–°ï¼š"
      flags: "m"

    # (2) åˆ é™¤"ğŸ—‚ ä¿¡æ¯"å—ï¼ˆåŒ…å«ä½“ç§¯/æ ‡ç­¾ç­‰ï¼‰ï¼Œç›´åˆ°ä¸‹ä¸€ä¸ªå¤§æ®µè½æˆ–æ–‡æœ¬ç»“æŸ
    - type: regex_replace
      pattern: "(?ms)^ğŸ—‚\\s*ä¿¡æ¯[:ï¼š]?\\s*$(?:\\n.*?)*?(?=^ğŸ“\\s*å†…å®¹ç®€ä»‹|^ğŸŸ|^ğŸ“¤|\\Z)"
      repl: ""

    # (3) åˆ é™¤æŠ•ç¨¿/é¢‘é“/ç¾¤ç»„/å¹¿å‘Šåˆä½œç­‰å°¾éƒ¨å¯¼æµä¿¡æ¯
    - type: regex_replace
      pattern: "(?s)ğŸŸ\\s*æŠ•ç¨¿äºº[ï¼š:].*$"
      repl: ""

    # (4) åˆ é™¤"é“¾æ¥ï¼šhttps://... + ğŸ“ å¤§å° + ğŸ· æ ‡ç­¾"å—
    - type: regex_replace
      pattern: "(?ms)^é“¾æ¥ï¼šhttps?://.*$(?:\\n\\s*)*^ğŸ“\\s*å¤§å°ï¼š.*$(?:\\n\\s*)*^ğŸ·\\s*æ ‡ç­¾ï¼š.*$"
      repl: ""

    # (5) åˆ é™¤"é˜¿é‡Œ/å¤¸å…‹/ç™¾åº¦ï¼šhttps://... + ğŸ“ å¤§å° + ğŸ· æ ‡ç­¾"å°¾éƒ¨ä¿¡æ¯
    - type: regex_replace
      pattern: "(?ms)^(?:é˜¿é‡Œ|å¤¸å…‹|ç™¾åº¦)ï¼šhttps?://.*$(?:\\n\\s*)*^ğŸ“\\s*å¤§å°ï¼š.*$(?:\\n\\s*)*^ğŸ·\\s*æ ‡ç­¾ï¼š.*$(?:\\n.*)*(?=\\Z)"
      repl: ""

    # (6) åˆ é™¤åŸæ–‡è‡ªå¸¦çš„"ğŸ“¤ èµ„æºé“¾æ¥ï¼š..."æç¤ºè¡Œ
    - type: regex_replace
      pattern: "(?m)^ğŸ“¤\\s*èµ„æºé“¾æ¥ï¼š.*$"
      repl: ""

    # (7) quark ç½‘ç›˜é“¾æ¥æ›¿æ¢ä¸ºè‡ªå®šä¹‰åœ°å€
    - type: regex_replace
      pattern: "https?://pan\\.quark\\.cn/s/[A-Za-z0-9]+"
      repl: "zhuiju.us"
      flags: "i"

    # (8) è¿½åŠ èµ„æºè¯´æ˜æ¨¡æ¿
    - type: append
      text: |
        ğŸ“¤ èµ„æºé“¾æ¥ï¼š
        åŠ å…¥QQç¾¤963115963æœèµ„æº
        æˆ–è®¿é—® zhuiju.us æœæ›´å¤šèµ„æº

# --------------------------------------------------
# æ—¥å¿—
# --------------------------------------------------
logging:
  # æ—¥å¿—ç­‰çº§ï¼šç›®å‰ä»…ç”¨äºæ§åˆ¶ debug è¾“å‡º
  level: INFO
  # æ˜¯å¦æ‰“å° TG äº‹ä»¶è°ƒè¯•æ—¥å¿—ï¼ˆæ”¶åˆ°æ¶ˆæ¯ã€è¿‡æ»¤åŸå› ã€å…¥é˜Ÿ/ä¸¢å¼ƒè¯¦æƒ…ï¼‰
  debug_tg_events: true
